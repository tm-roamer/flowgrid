!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.flowgrid=e()}(this,function(){"use strict";var t={THROTTLE_TIME:15,THROTTLE_LAZY_TIME:100},e={row:7,col:12,distance:5,draggable:!0,resizable:!0,nodeMinW:2,nodeMinH:2,overflow:5,padding:{top:5,left:5,right:5,bottom:5},cellScale:{w:16,h:9},addNodeSize:{x:0,y:0,w:2,h:2}},i={init:function(){this.arr||(this.arr=[])},get:function(t){return this.arr[t-1]},set:function(t){return this.arr.push(t),this.index()},remove:function(t){this.arr.splice(t,1)},index:function(){return this.arr.length},list:function(){return this.arr}},n={throttle:function(e){var i=(new Date).getTime();this.throttle=function(e){return e-i>t.THROTTLE_TIME&&(i=e,!0)},this.throttle(e)},throttleLazyId:"throttleLazyId",throttleLazy:function(e){clearTimeout(this.throttleLazyId),this.throttleLazyId=setTimeout(function(){e&&"function"==typeof e&&e()},t.THROTTLE_LAZY_TIME)},searchUp:function(t,e){if(t!==document.body&&t!==document)return t.classList.contains(e)?t:this.searchUp(t.parentNode,e)}},r={isResize:!1,dragNode:null,dragElement:null,dragStart:function(t,e,r,o,s){var a=this.container=n.searchUp(o,"fg-layout"),d=this.flowgrid=i.get(a.getAttribute("index"));if(d.opt.draggable){var l=d.$children[1*o.getAttribute("index")];this.dragNode=l,l.placeholder=!0,d.isDrag=!0;var h=this.dragElement=a.querySelector(".fg-item-dragdrop");h.setAttribute("style",o.getAttribute("style")),h.innerHTML=o.innerHTML;var c=a.getBoundingClientRect();if(this.containerX=c.left,this.containerY=c.top,s)this.isResize=s,this.offsetX=e||0,this.offsetY=r||0,d.resizeStart(l);else{var f=t.target.getBoundingClientRect(),u=o.getBoundingClientRect();this.offsetX=f.left-u.left+e||0,this.offsetY=f.top-u.top+r||0,d.dragStart(l)}}},drag:function(t){this.dragNode&&(this.prevX||(this.prevX=t.clientX),this.prevY||(this.prevY=t.clientY),this.dx=t.clientX-this.prevX,this.dy=t.clientY-this.prevY,this.prevX=t.clientX,this.prevY=t.clientY,this.pageX=t.clientX,this.pageY=t.clientY,this.isResize?this.resize():this.position())},position:function(){var t=this.flowgrid,e=this.pageX-this.containerX-this.offsetX,i=this.pageY-this.containerY-this.offsetY;this.dragElement.style.cssText+=";transform: translate("+e+"px,"+i+"px);";var n=t.opt.containerW,r=parseInt(this.dragElement.style.width);e<0&&(e=0),i<0&&(i=0),e+r>n&&(e=n-r);var o=this.dragNode.node,s=Math.round(e/t.opt.cellW_Int),a=Math.round(i/t.opt.cellH_Int);o.x===s&&o.y===a||(o.x=s,o.y=a,t.overlap(o,this.dx,this.dy,this.isResize),t.drag(this.dragNode))},resize:function(){var t=this.flowgrid,e=t.opt,i=this.dragNode.node,n=i.minW*e.cellW_Int-e.padding.left-e.padding.right-e.overflow,r=i.minH*e.cellH_Int-e.padding.top-e.padding.bottom-e.overflow,o=this.dragElement.style.transform.replace(/translate.*\(/gi,"").replace(/\).*$/gi,"").replace(/px/gi,"").split(","),s=parseInt(o[0]),a=parseInt(o[1]),d=this.pageX-this.containerX-s+this.offsetX,l=this.pageY-this.containerY-a+this.offsetY,h=e.containerW;d<n&&(d=n),l<r&&(l=r),d+s>h&&(d=h-s+e.overflow),this.dragElement.style.cssText+=";width: "+d+"px; height: "+l+"px;";var c=Math.ceil(d/e.cellW_Int),f=Math.ceil(l/e.cellH_Int);i.w===c&&i.h===f||(i.w=c,i.h=f,t.overlap(i,this.dx,this.dy,this.isResize),t.resize(this.dragNode))},dragEnd:function(t){this.dragNode&&(this.isResize?this.flowgrid.resizeEnd(this.dragNode):this.flowgrid.dragEnd(this.dragNode),this.dragElement.removeAttribute("style"),this.dragElement.innerHTML="",this.flowgrid.isDrag=!1,this.dragNode.placeholder=!1,this.isResize=!1,delete this.container,delete this.flowgrid,delete this.dragNode,delete this.dragElement,delete this.dx,delete this.dy,delete this.prevX,delete this.prevY,delete this.pageX,delete this.pageY,delete this.offsetX,delete this.offsetY,delete this.containerX,delete this.containerY)}},o=void 0,s={init:function(t,e){this.isbind||(o=e,this.isbind=t,this.unbindEvent(),this.bindEvent())},destroy:function(){this.unbindEvent()},bindEvent:function(){document.addEventListener("mousedown",this.mouseDown,!1),document.addEventListener("mousemove",this.mouseMove,!1),document.addEventListener("mouseup",this.mouseUp,!1),document.addEventListener("click",this.click,!0),this.isbind=!0},unbindEvent:function(){document.removeEventListener("mousedown",this.mouseDown,!1),document.removeEventListener("mousemove",this.mouseMove,!1),document.removeEventListener("mouseup",this.mouseUp,!1),document.removeEventListener("click",this.click,!0),this.isbind=!1},mouseDown:function(t){var e=s;e.ifLeft(t)&&(e.ele=n.searchUp(t.target,"fg-item"))&&(document.body.classList.add("fg-user-select-none"),t.target.classList.contains("fg-item-zoom-bar")&&(e.isResize=!0),e.dragStart=!0,e.distance=o.distance,e.distanceX=t.pageX,e.distanceY=t.pageY,e.offsetX=t.offsetX||0,e.offsetY=t.offsetY||0)},mouseMove:function(t){var e=s;if(e.ifLeft(t)&&e.ele)return e.dragStart&&e.isDrag(t)?(e.dragStart=!1,void r.dragStart(t,e.offsetX,e.offsetY,e.ele,e.isResize)):void(n.throttle((new Date).getTime())&&r.drag(t))},mouseUp:function(t){var e=s;e.ifLeft(t)&&(document.body.classList.remove("fg-user-select-none"),r.dragEnd(t),delete e.distance,delete e.distanceX,delete e.distanceY,delete e.offsetX,delete e.offsetY,delete e.isResize)},click:function(t){var e=s;!1===e.dragStart&&(t.stopPropagation(),delete e.dragStart)},isDrag:function(t){var e=s,i=Math.abs(t.pageX-e.distanceX||0),n=Math.abs(t.pageY-e.distanceY||0);if(e.distance<i||e.distance<n)return!0},ifLeft:function(t){return 0===t.button}};return{version:"2.2.3",fgContainer:{render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"fg-container"},[i("div",{staticClass:"fg-layout",class:{"fg-no-draggable":!t.opt.draggable,"fg-no-resizable":!t.opt.resizable},attrs:{index:t.index}},[t._t("default"),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isDrag,expression:"isDrag"}],staticClass:"fg-item-dragdrop"})],2)])},staticRenderFns:[],name:"fg-container",props:["setting","nodes"],computed:{opt:function(){var t=Object.assign({},e,this.setting||{});return this.computeCell(t),t}},data:function(){return{area:[],index:1,isDrag:!1}},methods:{computeCell:function(t){t.cellW=t.containerW/t.col,t.cellH=t.cellW/t.cellScale.w*t.cellScale.h,t.cellW_Int=Math.floor(t.cellW),t.cellH_Int=Math.floor(t.cellH)},init:function(){s.init(!0,this.opt),i.init(),this.index=i.set(this),this.load()},load:function(){this.buildArea(),this.layout()},buildArea:function(){for(var t=this.getMaxRowAndCol(),e=0;e<t.row;e++)this.area[e]=new Array(t.col);this.putNodes()},getMaxRowAndCol:function(){var t=this.opt,e=this.nodes,i={row:t.row,col:t.col};if(e&&e.length>0){var n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var d=s.value;d.y+d.h>i.row&&(i.row=d.y+d.h),d.x+d.w>i.col&&(i.col=d.x+d.w)}}catch(t){r=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}return i},putNodes:function(){var t=void 0,e=void 0,i=void 0,n=void 0,r=!0,o=!1,s=void 0;try{for(var a,d=this.nodes[Symbol.iterator]();!(r=(a=d.next()).done);r=!0){var l=a.value;for(t=l.y,i=l.y+l.h;t<i;t++)for(e=l.x,n=l.x+l.w;e<n;e++)this.area[t][e]=l.id}}catch(t){o=!0,s=t}finally{try{!r&&d.return&&d.return()}finally{if(o)throw s}}},getNodeCoord:function(t){var e=this.nodes,i=this.area;if(0===e.length)return t;var n,r,o=i[0].length;for(n=0;n<i.length;n+=1)for(t.y=n,r=0;r<i[0].length;r+=1)if(t.x=r,t.x+t.w>o&&(t.x=0),!this.collision(i,t))return t;return t.x=0,t.y=n,t},collision:function(t,e){for(var i=e.y;i<e.y+e.h;i++)for(var n=e.x;n<e.x+e.w;n++)if(t[i]&&(t[i][n]||0==t[i][n]))return!0},layout:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.nodes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=this.findEmptyLine(o);o.y>s&&this.moveUp(o,s)}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}},findEmptyLine:function(t){var e=void 0,i=void 0,n=void 0,r=this.area;for(e=t.y-1;e>=0;e--)for(i=t.x;i<t.x+t.w;i++)if((n=r[e][i])||0==n)return e+1;return 0},moveUp:function(t,e,i){t.y=e,i&&(t.id=i);for(var n=t.y;n<t.y+t.h;n++)for(var r=t.x;r<t.x+t.w;r++)this.area[n][r]=t.id},checkHit:function(t,e){var i=!1;return t.x+t.w>e.x&&t.x<e.x+e.w&&t.y+t.h>e.y&&t.y<e.y+e.h&&(i=!0),i},overlap:function(t,e,i,n){var r=this.nodes,e=e||0,i=i||0,o=null,s=0,a=0,n=n||!1,d=this.checkHit;if(!n){var l=!0,h=!1,c=void 0;try{for(var f,u=r[Symbol.iterator]();!(l=(f=u.next()).done);l=!0){var g=f.value;g!==t&&d(g,t)&&(E=g.y+g.h-t.y)>s&&(s=E,o=g)}}catch(t){h=!0,c=t}finally{try{!l&&u.return&&u.return()}finally{if(h)throw c}}if(o){var v=o.h/2<1?1:Math.floor(o.h/2);(i>=2&&i>=e?t.y+t.h-o.y:t.y-o.y)>=v&&(t.y=t.y+s)}}var p=!0,y=!1,m=void 0;try{for(var x,w=r[Symbol.iterator]();!(p=(x=w.next()).done);p=!0){var b=x.value;if(b!==t&&d(b,t)){var E=t.y-b.y;a=E>a?E:a}}}catch(t){y=!0,m=t}finally{try{!p&&w.return&&w.return()}finally{if(y)throw m}}var Y=!0,z=!1,L=void 0;try{for(var X,S=r[Symbol.iterator]();!(Y=(X=S.next()).done);Y=!0){var _=X.value;_!==t&&(_.y<t.y&&t.y<_.y+_.h||t.y<=_.y)&&(_.y=_.y+t.h+a)}}catch(t){z=!0,L=t}finally{try{!Y&&S.return&&S.return()}finally{if(z)throw L}}return this},dragStart:function(t){this.$emit("dragStart",this,t)},drag:function(t){this.$emit("drag",this,t)},dragEnd:function(t){this.$emit("dragEnd",this,t)},resizeStart:function(t){this.$emit("resizeStart",this,t)},resize:function(t){this.$emit("resize",this,t)},resizeEnd:function(t){this.$emit("resizeEnd",this,t)}},created:function(){this.init()},beforeUpdate:function(){this.load()},updated:function(){},mounted:function(){},destroyed:function(){s.destroy()}},fgItem:{render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"fg-item fg-item-animate",class:{"fg-item-placeholder":t.placeholder},style:t.itemStyle,attrs:{"fg-id":t.node.id,index:t.index}},[i("div",{staticClass:"fg-item-content"},[t._t("default")],2),t._v(" "),i("div",{staticClass:"fg-item-zoom-bar",attrs:{"fg-id":t.node.id,index:t.index}})])},staticRenderFns:[],name:"fg-item",props:["node","index"],computed:{itemStyle:function(){var t=this.$parent.opt,e=this.node;return this.width=e.w*t.cellW_Int-t.padding.left-t.padding.right,this.height=e.h*t.cellH_Int-t.padding.top-t.padding.bottom,{transform:"translate("+e.x*t.cellW_Int+"px,"+e.y*t.cellH_Int+"px)",width:this.width+"px",height:this.height+"px"}}},data:function(){return{placeholder:!1,width:0,height:0}}}}});